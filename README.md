# üèõÔ∏è SaaS Portal de Transpar√™ncia Municipal

<div align="center">

![Logo](https://img.shields.io/badge/Portal-Transpar√™ncia-blue?style=for-the-badge&logo=government&logoColor=white)
![Python](https://img.shields.io/badge/Python-3.11+-blue?style=for-the-badge&logo=python&logoColor=white)
![NextJS](https://img.shields.io/badge/Next.js-15+-black?style=for-the-badge&logo=nextdotjs&logoColor=white)
![TypeScript](https://img.shields.io/badge/TypeScript-5.0+-blue?style=for-the-badge&logo=typescript&logoColor=white)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15+-blue?style=for-the-badge&logo=postgresql&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-Compose-blue?style=for-the-badge&logo=docker&logoColor=white)

</div>

**Sistema SaaS completo para cria√ß√£o e gest√£o de portais de transpar√™ncia municipais** em conformidade com a Lei de Acesso √† Informa√ß√£o (LAI) e Lei Complementar 131/09. Desenvolvido para munic√≠pios brasileiros com **arquitetura moderna, escal√°vel e totalmente containerizada**.

## üìã √çndice

- [üèóÔ∏è Arquitetura do Sistema](#Ô∏è-arquitetura-do-sistema)
- [üöÄ Funcionalidades](#-funcionalidades)
- [üìä Diagramas do Sistema](#-diagramas-do-sistema)
- [‚ö° In√≠cio R√°pido](#-in√≠cio-r√°pido)
- [üõ†Ô∏è Instala√ß√£o Detalhada](#Ô∏è-instala√ß√£o-detalhada)
- [üîß Configura√ß√£o](#-configura√ß√£o)
- [üìö Documenta√ß√£o da API](#-documenta√ß√£o-da-api)
- [üèõÔ∏è Conformidade Legal](#Ô∏è-conformidade-legal)
- [ü§ù Contribui√ß√£o](#-contribui√ß√£o)
- [üìÑ Licen√ßa](#-licen√ßa)

## üèóÔ∏è Arquitetura do Sistema

### **Stack Tecnol√≥gico**

| Camada | Tecnologia | Vers√£o | Descri√ß√£o |
|--------|------------|---------|-----------|
| **Frontend** | Next.js + TypeScript | 15.x | Interface moderna e responsiva |
| **Backend** | FastAPI + Python | 3.11+ | API RESTful de alta performance |
| **Banco de Dados** | PostgreSQL | 15+ | Banco relacional robusto |
| **Cache** | Redis | 7+ | Cache distribu√≠do e sess√µes |
| **Search** | Elasticsearch | 8+ | Busca full-text otimizada |
| **Storage** | MinIO | Latest | Armazenamento de arquivos |
| **Proxy** | Nginx | Latest | Load balancer e proxy reverso |
| **Monitoramento** | Kibana | 8+ | Visualiza√ß√£o de logs e m√©tricas |
| **Containeriza√ß√£o** | Docker + Compose | Latest | Orquestra√ß√£o de containers |

### **Caracter√≠sticas T√©cnicas**

- ‚úÖ **Multi-tenant**: Isolamento completo por munic√≠pio
- ‚úÖ **API-First**: Arquitetura desacoplada e escal√°vel
- ‚úÖ **Real-time**: Atualiza√ß√µes em tempo real via WebSockets
- ‚úÖ **Microservices Ready**: Preparado para arquitetura de microsservi√ßos
- ‚úÖ **Cloud Native**: Deploy em qualquer provedor de nuvem
- ‚úÖ **LGPD Compliant**: Conformidade total com prote√ß√£o de dados
- ‚úÖ **High Availability**: Arquitetura para alta disponibilidade

## üöÄ Funcionalidades

### üìä **Dashboard Administrativo**
- **Vis√£o Executiva**: KPIs e m√©tricas em tempo real
- **Gest√£o de Usu√°rios**: Sistema completo de CRUD de usu√°rios
- **Controle de Acesso**: Permiss√µes granulares por m√≥dulo
- **Auditoria**: Log completo de todas as opera√ß√µes

### üí∞ **Gest√£o Financeira Transparente**
- **Receitas Municipais**: Cadastro e acompanhamento detalhado
- **Despesas P√∫blicas**: Controle total de gastos por categoria
- **Execu√ß√£o Or√ßament√°ria**: Acompanhamento em tempo real
- **Relat√≥rios Fiscais**: Exporta√ß√£o em formatos legais (PDF, Excel, CSV)
- **Indicadores Fiscais**: C√°lculos autom√°ticos de compliance

### üèõÔ∏è **Contratos e Licita√ß√µes**
- **Gest√£o de Contratos**: CRUD completo com controle de vig√™ncia
- **Processo Licitat√≥rio**: Acompanhamento de editais e resultados
- **Fornecedores**: Base de dados integrada
- **Documentos Anexos**: Armazenamento seguro de documenta√ß√£o

### üìù **Sistema e-SIC Integrado**
- **Portal do Cidad√£o**: Interface p√∫blica para solicita√ß√µes
- **Gest√£o de Pedidos**: Workflow completo de atendimento
- **Prazos Legais**: Controle autom√°tico de compliance temporal
- **Relat√≥rios LAI**: Dashboards de transpar√™ncia ativa

### üåê **Portal P√∫blico Responsivo**
- **Interface Cidad√£**: Design moderno e acess√≠vel
- **Busca Inteligente**: Full-text search com Elasticsearch
- **Visualiza√ß√µes Gr√°ficas**: Charts interativos com dados p√∫blicos
- **Downloads Abertos**: Exporta√ß√£o em formatos padronizados
- **SEO Otimizado**: Indexa√ß√£o completa pelos motores de busca

### üè¢ **Arquitetura Multi-tenant**
- **Isolamento Total**: Dados completamente segregados por munic√≠pio
- **Customiza√ß√£o**: Temas e configura√ß√µes personalizadas
- **Dom√≠nios Pr√≥prios**: Cada munic√≠pio com sua URL
- **Escalabilidade**: Suporte a milhares de munic√≠pios

## ÔøΩ Diagramas do Sistema

### üèóÔ∏è Arquitetura de Alto N√≠vel

```mermaid
graph TB
    subgraph "Frontend Layer"
        A[Next.js App] --> B[React Components]
        B --> C[TypeScript Hooks]
        C --> D[API Client]
    end
    
    subgraph "Backend Layer"
        E[FastAPI Server] --> F[Authentication]
        E --> G[CRUD Services]
        E --> H[Business Logic]
    end
    
    subgraph "Data Layer"
        I[(PostgreSQL)] --> J[User Data]
        I --> K[Financial Data]
        I --> L[Contract Data]
        I --> M[ESIC Requests]
        
        N[Redis Cache] --> O[Sessions]
        N --> P[API Cache]
        
        Q[Elasticsearch] --> R[Search Index]
        Q --> S[Analytics]
        
        T[MinIO] --> U[Documents]
        T --> V[Reports]
    end
    
    subgraph "Infrastructure"
        W[Docker Compose] --> X[Container Orchestration]
        Y[Nginx] --> Z[Load Balancer]
    end
    
    D --> E
    E --> I
    E --> N
    E --> Q
    E --> T
```

### üîÑ Fluxo de Dados CRUD

```mermaid
sequenceDiagram
    participant U as User Interface
    participant H as React Hook
    participant A as API Client
    participant B as Backend API
    participant D as Database
    participant C as Cache
    
    Note over U,C: Create Operation
    U->>H: Create Request
    H->>A: POST /api/entity
    A->>B: HTTP Request
    B->>D: INSERT Query
    D-->>B: Success Response
    B->>C: Cache Invalidation
    B-->>A: API Response
    A-->>H: Success Data
    H-->>U: State Update
    
    Note over U,C: Read Operation
    U->>H: Fetch Request
    H->>A: GET /api/entity
    A->>B: HTTP Request
    B->>C: Check Cache
    alt Cache Hit
        C-->>B: Cached Data
    else Cache Miss
        B->>D: SELECT Query
        D-->>B: Query Result
        B->>C: Update Cache
    end
    B-->>A: API Response
    A-->>H: Data Array
    H-->>U: State Update
```

### üèõÔ∏è Arquitetura Multi-tenant

```mermaid
graph LR
    subgraph "Tenant A - Munic√≠pio X"
        A1[Portal A] --> B1[Database Schema A]
        A1 --> C1[Files Bucket A]
    end
    
    subgraph "Tenant B - Munic√≠pio Y"  
        A2[Portal B] --> B2[Database Schema B]
        A2 --> C2[Files Bucket B]
    end
    
    subgraph "Shared Infrastructure"
        D[Load Balancer] --> A1
        D --> A2
        E[Shared Cache] --> A1
        E --> A2
        F[Monitoring] --> A1
        F --> A2
    end
    
    subgraph "Data Isolation"
        B1 --> G[(PostgreSQL)]
        B2 --> G
        C1 --> H[MinIO Storage]
        C2 --> H
    end
```

### üìù Fluxo do Sistema e-SIC

```mermaid
stateDiagram-v2
    [*] --> Submitted: Cidad√£o envia solicita√ß√£o
    Submitted --> InAnalysis: Operador recebe
    InAnalysis --> NeedsInfo: Informa√ß√µes insuficientes
    NeedsInfo --> InAnalysis: Cidad√£o complementa
    InAnalysis --> Approved: Pedido aprovado
    InAnalysis --> Rejected: Pedido negado
    Approved --> InProgress: Em processamento
    InProgress --> Answered: Resposta enviada
    InProgress --> Extended: Prazo prorrogado
    Extended --> Answered: Resposta enviada
    Answered --> [*]: Processo conclu√≠do
    Rejected --> [*]: Processo encerrado
    
    note right of Submitted
        Prazo: 20 dias √∫teis
        (Lei 12.527/2011)
    end note
```

### üîê Fluxo de Autentica√ß√£o

```mermaid
sequenceDiagram
    participant C as Client
    participant F as Frontend
    participant B as Backend
    participant D as Database
    participant R as Redis
    
    C->>F: Login Form Submit
    F->>B: POST /auth/login
    B->>D: Validate User
    D-->>B: User Data
    B->>R: Store Session
    B-->>F: JWT Token + User Data
    F->>F: Store in Context
    F-->>C: Redirect to Dashboard
    
    Note over C,R: Protected Route Access
    C->>F: Access Admin Page
    F->>F: Check Token
    alt Token Valid
        F->>B: API Request with Bearer Token
        B->>R: Validate Session
        R-->>B: Session Valid
        B-->>F: Protected Data
        F-->>C: Render Page
    else Token Invalid
        F-->>C: Redirect to Login
    end
```

## ‚ö° In√≠cio R√°pido

### üì¶ Execu√ß√£o com Docker (Recomendado)

```bash
# 1. Clone o reposit√≥rio
git clone https://github.com/diegothuran/saas-transparencia.git
cd saas-transparencia

# 2. Inicie todos os servi√ßos
docker-compose up -d

# 3. Aguarde a inicializa√ß√£o (pode levar alguns minutos)
docker-compose logs -f

# 4. Acesse a aplica√ß√£o
echo "‚úÖ Frontend: http://localhost:3000"
echo "‚úÖ Backend API: http://localhost:8000" 
echo "‚úÖ API Docs: http://localhost:8000/docs"
echo "‚úÖ Kibana: http://localhost:5601"
echo "‚úÖ MinIO: http://localhost:9001"
```

### üîë Credenciais Padr√£o

| Servi√ßo | Usu√°rio | Senha | URL |
|---------|---------|--------|-----|
| **Sistema Admin** | `admin` | `admin123` | http://localhost:3000/login |
| **MinIO Console** | `minioadmin` | `minioadmin` | http://localhost:9001 |
| **Kibana** | - | - | http://localhost:5601 |

## üõ†Ô∏è Instala√ß√£o Detalhada

### Pr√©-requisitos

- ‚úÖ **Docker**: 20.10+
- ‚úÖ **Docker Compose**: 2.0+
- ‚úÖ **Git**: 2.30+
- ‚úÖ **Mem√≥ria RAM**: 4GB m√≠nimo (8GB recomendado)
- ‚úÖ **Espa√ßo em Disco**: 10GB livres

### Execu√ß√£o com Docker
```bash
# 1. Clone o reposit√≥rio
git clone https://github.com/diegothuran/saas-transparencia.git
cd saas-transparencia

# 2. Configure as vari√°veis de ambiente
cp .env.example .env
# Edite o arquivo .env com suas configura√ß√µes

# 3. Construa e inicie os containers
docker-compose build --no-cache
docker-compose up -d

# 4. Execute as migra√ß√µes do banco
docker-compose exec backend alembic upgrade head

# 5. Crie o usu√°rio administrador
docker-compose exec backend python create_initial_data.py

# 6. Verifique se todos os servi√ßos est√£o executando
docker-compose ps
```

### üîß Desenvolvimento Local

**Backend (FastAPI + Python)**

```bash
cd backend

# Configure ambiente virtual
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate     # Windows

# Instale depend√™ncias
pip install -r requirements.txt

# Configure vari√°veis de ambiente
cp .env.example .env

# Execute migra√ß√µes
alembic upgrade head

# Inicie o servidor de desenvolvimento
uvicorn app.main:app --reload --port 8000
```

**Frontend (Next.js + TypeScript)**

```bash
cd frontend

# Instale depend√™ncias
npm install
# ou
yarn install

# Configure vari√°veis de ambiente
cp .env.example .env.local

# Inicie o servidor de desenvolvimento
npm run dev
# ou
yarn dev
```

## üîß Configura√ß√£o

### üìã Vari√°veis de Ambiente

**Backend (.env)**

```env
# Database Configuration
DATABASE_URL=postgresql://postgres:postgres@localhost:5433/transparencia
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=transparencia

# Redis Configuration  
REDIS_URL=redis://localhost:6379/0

# Security Configuration
SECRET_KEY=your-super-secret-key-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Email Configuration (opcional)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com  
SMTP_PASSWORD=your-app-password
EMAILS_FROM_EMAIL=noreply@transparencia.gov.br

# File Storage Configuration
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_ENDPOINT=localhost:9000
MINIO_BUCKET=transparencia-files

# Elasticsearch Configuration
ELASTICSEARCH_URL=http://localhost:9200

# Environment
ENVIRONMENT=development
DEBUG=true
```

**Frontend (.env.local)**

```env
# API Configuration
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Environment
NODE_ENV=development
```

### üê≥ Configura√ß√£o Docker

O arquivo `docker-compose.yml` inclui todos os servi√ßos necess√°rios:

- **frontend**: Next.js app (porta 3000)
- **backend**: FastAPI app (porta 8000)  
- **postgres**: Banco de dados PostgreSQL (porta 5433)
- **redis**: Cache e sess√µes (porta 6379)
- **elasticsearch**: Busca full-text (porta 9200)
- **kibana**: Dashboard de logs (porta 5601)
- **minio**: Armazenamento de arquivos (portas 9000, 9001)
- **nginx**: Proxy reverso (portas 8080, 8443)

## üìö Documenta√ß√£o da API

### üîó Endpoints Principais

A documenta√ß√£o interativa da API est√° dispon√≠vel em:
- **Swagger UI**: <http://localhost:8000/docs>
- **ReDoc**: <http://localhost:8000/redoc>

### üìã Principais Rotas

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| `POST` | `/auth/login` | Autentica√ß√£o de usu√°rio |
| `GET` | `/users/` | Listar usu√°rios |
| `POST` | `/users/` | Criar usu√°rio |
| `GET` | `/financial/revenues/` | Listar receitas |
| `POST` | `/financial/revenues/` | Criar receita |
| `GET` | `/financial/expenses/` | Listar despesas |
| `POST` | `/financial/expenses/` | Criar despesa |
| `GET` | `/contracts/` | Listar contratos |
| `POST` | `/contracts/` | Criar contrato |
| `GET` | `/esic/` | Listar solicita√ß√µes e-SIC |
| `POST` | `/esic/` | Criar solicita√ß√£o e-SIC |

### üìä Exemplo de Uso da API

```bash
# 1. Fazer login e obter token
curl -X POST "http://localhost:8000/auth/login" \
     -H "Content-Type: application/x-www-form-urlencoded" \
     -d "username=admin&password=admin123"

# 2. Usar token nas requisi√ß√µes (substitua SEU_TOKEN)
curl -X GET "http://localhost:8000/users/" \
     -H "Authorization: Bearer SEU_TOKEN"

# 3. Criar uma receita
curl -X POST "http://localhost:8000/financial/revenues/" \
     -H "Authorization: Bearer SEU_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "source": "ICMS",
       "amount": 150000.00,
       "date": "2025-01-15",
       "category": "Imposto"
     }'
```

## üöÄ Deploy em Produ√ß√£o

### üåä Deploy no Heroku

```bash
# 1. Instale o Heroku CLI
# https://devcenter.heroku.com/articles/heroku-cli

# 2. Fa√ßa login
heroku login

# 3. Crie a aplica√ß√£o
heroku create seu-portal-transparencia

# 4. Configure as vari√°veis de ambiente
heroku config:set SECRET_KEY=your-production-secret-key
heroku config:set DATABASE_URL=your-postgres-url
heroku config:set REDIS_URL=your-redis-url

# 5. Adicione o buildpack para Docker
heroku stack:set container

# 6. Deploy
git push heroku main
```

### ‚òÅÔ∏è Deploy na AWS/Digital Ocean

```yaml
# docker-compose.prod.yml exemplo
version: '3.8'
services:
  frontend:
    build: ./frontend
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_API_BASE_URL=https://api.seudominio.com
    
  backend:
    build: ./backend
    environment:
      - ENVIRONMENT=production
      - DEBUG=false
      - DATABASE_URL=postgresql://user:pass@rds-endpoint/db
      - REDIS_URL=redis://elasticache-endpoint:6379
```

## üèõÔ∏è Conformidade Legal

### ‚öñÔ∏è Legisla√ß√£o Atendida

Este sistema foi desenvolvido para **atender integralmente**:

- ‚úÖ **Lei n¬∫ 12.527/2011** (Lei de Acesso √† Informa√ß√£o - LAI)
- ‚úÖ **Lei Complementar n¬∫ 131/2009** (Lei da Transpar√™ncia)
- ‚úÖ **Decreto n¬∫ 7.724/2012** (Regulamenta√ß√£o da LAI)
- ‚úÖ **Lei n¬∫ 13.709/2018** (LGPD - Lei Geral de Prote√ß√£o de Dados)
- ‚úÖ **Diretrizes WCAG 2.1** (Acessibilidade Web)

### üìä Itens de Transpar√™ncia Obrigat√≥ria

| Item | Status | Localiza√ß√£o |
|------|--------|-------------|
| Receitas e despesas | ‚úÖ | `/receitas`, `/despesas` |
| Contratos e licita√ß√µes | ‚úÖ | `/contratos`, `/licitacoes` |
| Folha de pagamento | ‚úÖ | `/servidores` |
| Estrutura organizacional | ‚úÖ | `/estrutura` |
| e-SIC (Pedidos LAI) | ‚úÖ | `/esic` |
| Agenda de autoridades | ‚è≥ | Em desenvolvimento |
| Conv√™nios e parcerias | ‚è≥ | Em desenvolvimento |

### üîí Prote√ß√£o de Dados Pessoais (LGPD)

- **Minimiza√ß√£o**: Coleta apenas dados estritamente necess√°rios
- **Finalidade**: Uso exclusivo para transpar√™ncia p√∫blica
- **Adequa√ß√£o**: Processamento adequado aos prop√≥sitos informados
- **Necessidade**: Limita√ß√£o ao m√≠nimo necess√°rio
- **Qualidade**: Dados exatos, claros e atualizados
- **Transpar√™ncia**: Informa√ß√µes claras sobre tratamento
- **Seguran√ßa**: Medidas t√©cnicas e organizacionais
- **Preven√ß√£o**: Medidas preventivas de danos

## üß™ Testes

### üîç Executar Testes

```bash
# Backend - Testes unit√°rios e de integra√ß√£o
cd backend
python -m pytest tests/ -v --cov=app

# Frontend - Testes unit√°rios  
cd frontend
npm run test
npm run test:coverage

# Testes E2E com Playwright
npm run test:e2e
```

### üìà Cobertura de Testes

- **Backend**: >90% cobertura
- **Frontend**: >85% cobertura  
- **E2E**: Fluxos cr√≠ticos cobertos

## ü§ù Contribui√ß√£o

Contribui√ß√µes s√£o bem-vindas! Siga estas etapas:

### üìù Processo de Contribui√ß√£o

1. **Fork** o projeto
2. **Clone** seu fork: `git clone https://github.com/seu-usuario/saas-transparencia.git`
3. **Crie uma branch**: `git checkout -b feature/nova-funcionalidade`
4. **Implemente** suas mudan√ßas
5. **Teste** suas altera√ß√µes: `npm test && python -m pytest`
6. **Commit** suas mudan√ßas: `git commit -m 'feat: adiciona nova funcionalidade'`
7. **Push** para a branch: `git push origin feature/nova-funcionalidade`
8. **Abra um Pull Request**

### üìã Padr√µes de C√≥digo

- **Commits**: Siga o padr√£o [Conventional Commits](https://www.conventionalcommits.org/)
- **Code Style**: 
  - Python: `black` + `flake8`
  - TypeScript: `eslint` + `prettier`
- **Documenta√ß√£o**: Mantenha documenta√ß√£o atualizada
- **Testes**: Inclua testes para novas funcionalidades

## üìû Suporte

### üêõ Reportar Bugs

Encontrou um bug? [Abra uma issue](https://github.com/diegothuran/saas-transparencia/issues) com:
- Descri√ß√£o detalhada do problema
- Passos para reproduzir
- Ambiente (OS, vers√µes, etc.)
- Screenshots se aplic√°vel

### üí¨ Discuss√µes

Para d√∫vidas gerais e discuss√µes, utilize as [GitHub Discussions](https://github.com/diegothuran/saas-transparencia/discussions).

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a **Licen√ßa MIT** - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üë®‚Äçüíª Autor

**Diego Thuran**
- GitHub: [@diegothuran](https://github.com/diegothuran)
- LinkedIn: [Diego Thuran](https://linkedin.com/in/diegothuran)
- Email: <diego@thuran.dev>

---

<div align="center">

**üèõÔ∏è Desenvolvido para a transpar√™ncia p√∫blica brasileira üáßüá∑**

![Footer](https://img.shields.io/badge/Made%20with-‚ù§Ô∏è-red?style=for-the-badge)
![Brasil](https://img.shields.io/badge/Brasil-üáßüá∑-green?style=for-the-badge)

*"A transpar√™ncia √© o melhor rem√©dio contra a corrup√ß√£o"*

</div>

